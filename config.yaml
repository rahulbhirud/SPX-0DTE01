# ============================================================
# TradeStation API Configuration
# ============================================================

# ----- Account Mode -----
# Set to "sim" for Simulated account, "live" for Live account
account_mode: "sim"

# ----- API Credentials -----
credentials:
  client_id: "qdWl7XZlhJAgfGX5lXjsLKIYwJHIblSB"
  client_secret: "t9ZmqD5bBQM4Gqk7lnoEDqxTqD0NM9_GvLyiIBa4-WhU0WnhP46YIhkVN822FlTT"
  redirect_uri: "http://localhost:3000/callback"
  refresh_token: "dksi0aBxm2QNWcsxB-XGBO5cRzFMtYiX2-u1KmjDgkxbi"


# ----- Account IDs -----
accounts:
  sim: "SIM3170696M"    # Simulated account ID
  live: "SIM3170696M"       # Live account ID

# ----- API Endpoints -----
endpoints:
  auth_url: "https://signin.tradestation.com/authorize"
  token_url: "https://signin.tradestation.com/oauth/token"
  base_url:  "https://sim-api.tradestation.com/v3"

# ----- Streaming Configuration -----

streaming:
  symbol: "$SPX.X"          # SPX index symbol on TradeStation
  bar_unit: "Minute"         # Minute | Daily | Weekly | Monthly
  bar_interval: 5            # 5-minute candles
  # ⚠ bars_back must be > rsi.period + 1 so RSI warms up on historical bars
  # Recommended: at least rsi.period * 3 (e.g. 27 for period=9)
  bars_back: 50
  session_template: "Default"  # Default | USEQPre | USEQPost | USEQ24Hour

# ----- Token Storage -----
token:
  storage_path: "./ts_token.json"

# ----- Logging -----
logging:
  level: "DEBUG"             # DEBUG | INFO | WARNING | ERROR
  log_to_file: true
  log_file: "./spx_stream.log"
  max_bytes: 5242880         # 5 MB
  backup_count: 3

# ----- Reconnection -----
reconnection:
  enabled: true
  max_retries: 10
  retry_delay_seconds: 5
  max_delay_seconds: 120

# ============================================================
# RSI Analysis Settings
# ============================================================
rsi:
  # ── Core RSI ──────────────────────────────────────────────
  period: 9                  # RSI lookback period (classic: 14, aggressive: 9)
  overbought: 70.0           # Log zone label when RSI ≥ this
  oversold: 30.0             # Log zone label when RSI ≤ this

  # ── Zone Thresholds for Signal Gating ───────────────────────
  # Plateau & divergence only fire when RSI is in an actionable zone.
  # These are softer than overbought/oversold to catch signals early.
  signal_zone_upper: 60.0    # Bearish signals require RSI ≥ this
  signal_zone_lower: 40.0    # Bullish signals require RSI ≤ this

  # ── Plateau Detection ─────────────────────────────────────
  # A plateau is called when (max_RSI - min_RSI) across the last
  # `plateau_window` *closed* bars falls within `plateau_threshold`.
  # Only fires when RSI is in an actionable zone (≥ upper or ≤ lower).
  plateau_window: 3          # Number of consecutive closed bars to examine
  plateau_threshold: 3.0     # Max RSI point range to qualify as a plateau


  # ── RSI Reversal (Momentum Shift) ────────────────────────
  # Fires when RSI drops/rises sharply from an extreme zone within
  # a few bars — catches fast reversals that divergence would miss.
  #
  # Example: RSI at 75 drops to 62 in 2 bars → BEARISH_REVERSAL
  reversal_enabled: true
  reversal_window: 3         # Max bars over which the RSI swing occurred
  reversal_rsi_drop: 8.0     # Min RSI pts drop from recent peak (bearish)
  reversal_rsi_rise: 8.0     # Min RSI pts rise from recent trough (bullish)

# ============================================================
# Options Chain Scheduler
# ============================================================
# Streams the options chain every N seconds, identifies credit
# spreads filtered by delta and premium, and saves candidates
# to options_data_config.json.
options_scheduler:
  enabled: true
  underlying: "$SPXW.X"         # Symbol for option-chain lookup
  fetch_interval: 5              # Seconds between fetches
  strike_proximity: 150         # Strikes around ATM to request
  spread_widths: [5, 10, 15, 20, 30] # Vertical spread widths (points)
  max_delta: 0.10                # Short leg must have |delta| < this (10 delta)
  min_premium: 0.40              # Minimum net credit ($)
  max_premium: 0.70              # Maximum net credit ($)
